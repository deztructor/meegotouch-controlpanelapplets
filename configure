#!/bin/sh

FILENAME=localconfig.pri

cat > ${FILENAME} << EOF
#
# This file has been generated by the configure script of the
# meegotouch-controlpanelapplets package. The file will be automatically
# overwritten, please do not modify.
#
EOF

which pkg-config > /dev/null
if [ $? -eq 0 ]; then
    #
    # Most of applets needs the path for restore-settings/clean-user-data scripts
    #
    RFS_DIR=$(pkg-config clean-device --variable=rfs_scripts_dir)
    CUD_DIR=$(pkg-config clean-device --variable=cud_scripts_dir)
    echo "RFS_DIR = ${RFS_DIR}" >> ${FILENAME}
    echo "CUD_DIR = ${CUD_DIR}" >> ${FILENAME}

    #
    # We have a heavy QmSystem2 dependency in the displayapplet and in the
    # batteryapplet. This is the most important closed source dependency of the
    # source
    #
    pkg-config --exists qmsystem2
    if [ $? -eq 0 ]; then
        echo "DEFINES += HAVE_QMSYSTEM" >> ${FILENAME}
    fi

    #
    # The wallpaper applet uses the contentmaneger to implement the 'select from
    # my gallery' widget.
    #
    pkg-config --exists ContentManager
    if [ $? -eq 0 ]; then
        echo "DEFINES += HAVE_CONTENT_MANAGER" >> ${FILENAME}
    fi

    #
    # Soundsettings applet and profile uis needs the low level libprofile API
    #
    pkg-config --exists profile
    if [ $? -eq 0 ]; then
	echo "DEFINES += HAVE_LIBPROFILE" >> ${FILENAME}
    fi

    #
    # Soundsettings applet and profile uis needs libresourceqt
    #
    pkg-config --exists libresourceqt1    
    if [ $? -eq 0 ]; then
        echo "DEFINES += HAVE_LIBRESOURCEQT" >> ${FILENAME}
    fi

    #
    # For better image handling, we need quill-image-filter for wallpaper applet
    #
    pkg-config --exists quillimagefilter
    if [ $? -eq 0 ]; then
        echo "DEFINES += HAVE_QUILL_FILTER" >> ${FILENAME}
    fi

    #
    # Need the quill metadata for the exif information. 
    #
    pkg-config --exists quillmetadata
    if [ $? -eq 0 ]; then
        echo "DEFINES += HAVE_QUILL_METADATA" >> ${FILENAME}
    fi

    #
    # QtSparql needed for ringtone/wallpaper applet
    #
    pkg-config --exists QtSparql
    if [ $? -eq 0 ]; then
        echo "DEFINES += HAVE_QTSPARQL" >> ${FILENAME}
    fi


    #
    # QtSparqlTrackerLive needed for ringtone/wallpaper applet
    # in the future
    #
    pkg-config --exists QtSparqlTrackerLive
    if [ $? -eq 0 ]; then
        echo "DEFINES += HAVE_QTSPARQL_LIVE" >> ${FILENAME}
    fi
fi

#
# We need also the DBus interfaces names, and some meta-type registration
# from devicelock-dev header (in reset-settings applet)
#
if [ -e /usr/include/devicelock/devicelock.h ]; then
    echo "DEFINES += HAVE_DEVICELOCK" >> ${FILENAME}
fi

# 
# silent builds make debugging build failures in integration servers
# pain in the neck. So lets make the silent build configurable from 
# central place  ..
#
# FIXME: Well, except it is not configurable is it?
#
echo "CONFIG += silent" >> ${FILENAME}

#echo "# All values were removed for testing purposes..." > ${FILENAME}

echo Configured meegotouch-controlpanelapplets as follows:
echo =====================================================
cat ${FILENAME}
